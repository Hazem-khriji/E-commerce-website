{#{% extends('base.html.twig') %}#}
{#{% set current_page = 'cart' %}#}

{#{% block body %}#}
{#		<!-- Start Hero Section -->#}
{#			<div class="hero">#}
{#				<div class="container">#}
{#					<div class="row justify-content-between">#}
{#						<div class="col-lg-5">#}
{#							<div class="intro-excerpt">#}
{#								<h1>Cart</h1>#}
{#							</div>#}
{#						</div>#}
{#						<div class="col-lg-7">#}
{#							#}
{#						</div>#}
{#					</div>#}
{#				</div>#}
{#			</div>#}
{#		<!-- End Hero Section -->#}

{#		#}

{#		<div class="untree_co-section before-footer-section">#}
{#            <div class="container">#}
{#              <div class="row mb-5">#}
{#                <form class="col-md-12" method="post">#}
{#                  <div class="site-blocks-table">#}
{#                    <table class="table">#}
{#                      <thead>#}
{#                        <tr>#}
{#                          <th class="product-thumbnail">Image</th>#}
{#                          <th class="product-name">Product</th>#}
{#                          <th class="product-price">Price</th>#}
{#                          <th class="product-quantity">Quantity</th>#}
{#                          <th class="product-total">Total</th>#}
{#                          <th class="product-remove">Remove</th>#}
{#                        </tr>#}
{#                      </thead>#}
{#                      <tbody>#}
{#                        <tr>#}
{#                          {% if items|length == 0 %}#}
{#                            <p><strong>You haven't added any product to cart yet .</strong></p>#}
{#                          {% endif %}#}
{#                          {% for item in items %}#}
{#                        <tr class="cart-item" data-price="{{ item.product.price }}">#}
{#                          <td class="product-thumbnail">#}
{#                            <img src="{{ asset('images/' ~ item.product.imageUrl) }}" alt="Image" class="img-fluid">#}
{#                          </td>#}
{#                          <td>{{ item.product.name }}</td>#}
{#                          <td>{{ item.product.price }}$</td>#}
{#                          <td>#}
{#                            <div class="input-group mb-3 d-flex align-items-center quantity-container" style="max-width: 120px;">#}
{#                              <div class="input-group-prepend">#}
{#                                <button type="button" class="btn btn-outline-black" onclick="changeQuantity({{ item.product.id }}, -1)">−</button>#}
{#                              </div>#}

{#                              <input#}
{#                                      type="number"#}
{#                                      min="1"#}
{#                                      class="form-control text-center quantity-amount"#}
{#                                      id="quantity-{{ item.product.id }}"#}
{#                                      value="{{ item.quantity }}"#}
{#                              >#}

{#                              <div class="input-group-append">#}
{#                                <button type="button" class="btn btn-outline-black" onclick="changeQuantity({{ item.product.id }}, 1)">+</button>#}
{#                              </div>#}
{#                            </div>#}

{#                          </td>#}
{#                          <td>{{ item.product.price * item.quantity }}$</td>#}
{#                          <td><a href="{{ path('cart_remove', {id: item.product.id}) }}" class="btn btn-black btn-sm">X</a></td>#}
{#                        </tr>#}
{#                        {% endfor %}#}
{#                      </tbody>#}
{#                    </table>#}
{#                  </div>#}
{#                </form>#}
{#              </div>#}
{#        #}
{#              <div class="row">#}
{#                <div class="col-md-6">#}
{#                  <div class="row mb-5">#}
{#                    <div class="col-md-6 mb-3 mb-md-0">#}
{#                      <a href="{{ path('app_cart') }}" class="btn btn-black btn-sm btn-block">Update Cart</a>#}
{#                    </div>#}
{#                    <div class="col-md-6">#}
{#                      <a href="{{ path('app_shop') }}" class="btn btn-outline-black btn-sm btn-block"> Continue Shopping</a>#}
{#                    </div>#}
{#                  </div>#}
{#                  <div class="row">#}
{#                    <div class="col-md-12">#}
{#                      <label class="text-black h4" for="coupon">Coupon</label>#}
{#                      <p>Enter your coupon code if you have one.</p>#}
{#                    </div>#}
{#                    <div class="col-md-8 mb-3 mb-md-0">#}
{#                      <input type="text" class="form-control py-3" id="coupon" placeholder="Coupon Code">#}
{#                    </div>#}
{#                    <div class="col-md-4">#}
{#                      <button class="btn btn-black">Apply Coupon</button>#}
{#                    </div>#}
{#                  </div>#}
{#                </div>#}
{#                <div class="col-md-6 pl-5">#}
{#                  <div class="row justify-content-end">#}
{#                    <div class="col-md-7">#}
{#                      <div class="row">#}
{#                        <div class="col-md-12 text-right border-bottom mb-5">#}
{#                          <h3 class="text-black h4 text-uppercase">Cart Totals</h3>#}
{#                        </div>#}
{#                      </div>#}
{#                      <div class="row mb-3">#}
{#                        <div class="col-md-6">#}
{#                          <span class="text-black">Subtotal</span>#}
{#                        </div>#}
{#                        <div class="col-md-6 text-right">#}
{#                          <strong class="text-black">{{ total }}$</strong>#}
{#                        </div>#}
{#                      </div>#}
{#                      <div class="row mb-5">#}
{#                        <div class="col-md-6">#}
{#                          <span class="text-black">Total</span>#}
{#                        </div>#}
{#                        <div class="col-md-6 text-right">#}
{#                          <strong class="text-black">{{ total }}$</strong>#}
{#                        </div>#}
{#                      </div>#}
{#        #}
{#                      <div class="row">#}
{#                        <div class="col-md-12">#}
{#                          <button class="btn btn-black btn-lg py-3 btn-block" onclick="window.location='checkout.html.twig'">Proceed To Checkout</button>#}
{#                        </div>#}
{#                      </div>#}
{#                    </div>#}
{#                  </div>#}
{#                </div>#}
{#              </div>#}
{#            </div>#}
{#          </div>#}
{#  <script>#}
{#    function changeQuantity(productId, change) {#}
{#      const input = document.getElementById('quantity-' + productId);#}
{#      let newQuantity = parseInt(input.value) + change;#}

{#      if (newQuantity < 1) newQuantity = 1;#}
{#      input.value = newQuantity;#}

{#      fetch(`/cart/update/${productId}`, {#}
{#        method: 'POST',#}
{#        headers: {#}
{#          'Content-Type': 'application/x-www-form-urlencoded',#}
{#          'X-Requested-With': 'XMLHttpRequest'#}
{#        },#}
{#        body: `quantity=${newQuantity}`#}
{#      })#}
{#              .then(response => {#}
{#                if (!response.ok) {#}
{#                  alert('Failed to update cart');#}
{#                }#}
{#              });#}
{#    }#}
{#    function recalculateCartTotal() {#}
{#      let total = 0;#}

{#      document.querySelectorAll('.cart-item').forEach(item => {#}
{#        const price = parseFloat(item.dataset.price);#}
{#        const quantityInput = item.querySelector('.quantity-input');#}
{#        const quantity = parseInt(quantityInput.value);#}

{#        // Update item total display#}
{#        const itemTotal = price * quantity;#}
{#        item.querySelector('.item-total').textContent = itemTotal.toFixed(2) + ' $';#}


{#        total += itemTotal;#}
{#      });#}

{#      // Update the cart total label#}
{#      document.getElementById('cart-total').textContent = total.toFixed(2) + '$';#}
{#    }#}

{#    // Attach listener to all quantity inputs#}
{#    document.querySelectorAll('.quantity-input').forEach(input => {#}
{#      input.addEventListener('change', function () {#}
{#        recalculateCartTotal();#}
{#      });#}
{#    });#}
{#  </script>#}

{#{% endblock %}#}
{% extends('base.html.twig') %}
{% set current_page = 'cart' %}

{% block body %}
    <!-- Start Hero Section -->
    <div class="hero">
        <div class="container">
            <div class="row justify-content-between">
                <div class="col-lg-5">
                    <div class="intro-excerpt">
                        <h1>Cart</h1>
                    </div>
                </div>
                <div class="col-lg-7"></div>
            </div>
        </div>
    </div>
    <!-- End Hero Section -->

    <div class="untree_co-section before-footer-section">
        <div class="container">
            <div class="row mb-5">
                <form class="col-md-12" method="post">
                    <div class="site-blocks-table">
                        <table class="table">
                            <thead>
                            <tr>
                                <th class="product-thumbnail">Image</th>
                                <th class="product-name">Product</th>
                                <th class="product-price">Price</th>
                                <th class="product-quantity">Quantity</th>
                                <th class="product-total">Total</th>
                                <th class="product-remove">Remove</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% if items|length == 0 %}
                                <p><strong>You haven't added any product to cart yet.</strong></p>
                            {% endif %}
                            {% for item in items %}
                                <tr class="cart-item" data-price="{{ item.product.price }}">
                                    <td class="product-thumbnail">
                                        <img src="{{ asset('images/' ~ item.product.imageUrl) }}" alt="Image" class="img-fluid">
                                    </td>
                                    <td>{{ item.product.name }}</td>
                                    <td>{{ item.product.price }}$</td>
                                    <td>
                                        <div class="input-group mb-3 d-flex align-items-center quantity-container" style="max-width: 120px;">
                                            <div class="input-group-prepend">
                                                <button type="button" class="btn btn-outline-black" onclick="changeQuantity({{ item.product.id }}, -1)">−</button>
                                            </div>
                                            <input
                                                    type="number"
                                                    min="1"
                                                    class="form-control text-center quantity-amount quantity-input"
                                                    id="quantity-{{ item.product.id }}"
                                                    value="{{ item.quantity }}"
                                            >
                                            <div class="input-group-append">
                                                <button type="button" class="btn btn-outline-black" onclick="changeQuantity({{ item.product.id }}, 1)">+</button>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="item-total">{{ (item.product.price * item.quantity)|number_format(2) }}$</td>
                                    <td><a href="{{ path('cart_remove', {id: item.product.id}) }}" class="btn btn-black btn-sm">X</a></td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </form>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="row mb-5">
                        <div class="col-md-6 mb-3 mb-md-0">
                            <a href="{{ path('app_cart') }}" class="btn btn-black btn-sm btn-block">Update Cart</a>
                        </div>
                        <div class="col-md-6">
                            <a href="{{ path('app_shop') }}" class="btn btn-outline-black btn-sm btn-block">Continue Shopping</a>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <label class="text-black h4" for="coupon">Coupon</label>
                            <p>Enter your coupon code if you have one.</p>
                        </div>
                        <div class="col-md-8 mb-3 mb-md-0">
                            <input type="text" class="form-control py-3" id="coupon" placeholder="Coupon Code">
                        </div>
                        <div class="col-md-4">
                            <button class="btn btn-black">Apply Coupon</button>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 pl-5">
                    <div class="row justify-content-end">
                        <div class="col-md-7">
                            <div class="row">
                                <div class="col-md-12 text-right border-bottom mb-5">
                                    <h3 class="text-black h4 text-uppercase">Cart Totals</h3>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <span class="text-black">Subtotal</span>
                                </div>
                                <div class="col-md-6 text-right">
                                    <strong class="text-black" id="cart-total">{{ total|number_format(2) }}$</strong>
                                </div>
                            </div>
                            <div class="row mb-5">
                                <div class="col-md-6">
                                    <span class="text-black">Total</span>
                                </div>
                                <div class="col-md-6 text-right">
                                    <strong class="text-black" id="cart-total-final">{{ total|number_format(2) }}$</strong>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <button class="btn btn-black btn-lg py-3 btn-block" onclick="window.location='{{ path('app_checkout') }}'">Proceed To Checkout</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function changeQuantity(productId, change) {
            const input = document.getElementById('quantity-' + productId);
            let newQuantity = parseInt(input.value) + change;

            if (newQuantity < 1) newQuantity = 1;
            input.value = newQuantity;

            fetch(`/cart/update/${productId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-Requested-With': 'XMLHttpRequest'
                },
                body: `quantity=${newQuantity}`
            })
                .then(response => {
                    if (response.ok) {
                        recalculateCartTotal();
                    } else {
                        alert('Failed to update cart');
                    }
                });
        }

        function recalculateCartTotal() {
            let total = 0;

            document.querySelectorAll('.cart-item').forEach(item => {
                const price = parseFloat(item.dataset.price);
                const quantityInput = item.querySelector('.quantity-input');
                const quantity = parseInt(quantityInput.value);

                // Update item total display
                const itemTotal = price * quantity;
                item.querySelector('.item-total').textContent = itemTotal.toFixed(2) + '$';

                total += itemTotal;
            });

            // Update the cart total labels
            document.getElementById('cart-total').textContent = total.toFixed(2) + '$';
            document.getElementById('cart-total-final').textContent = total.toFixed(2) + '$';
        }

        // Attach listener to all quantity inputs
        document.querySelectorAll('.quantity-input').forEach(input => {
            input.addEventListener('change', function() {
                recalculateCartTotal();
            });
        });
    </script>
{% endblock %}